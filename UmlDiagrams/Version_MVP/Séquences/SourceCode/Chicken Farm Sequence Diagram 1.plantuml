@startuml MVP_Sequence_Diagram_1_Login

title Sequence Diagram 1: Login

actor "Admin User" as Admin
participant "LoginView" as UI
participant "LoginController" as Controller
participant "ValidationUtil" as Validator
participant "UserDAO" as DAO
participant "DatabaseConnection" as DB
participant "DashboardView" as Dashboard

== Login Process ==

Admin -> UI: Enter email and password
Admin -> UI: Click "Login" button

UI -> Controller: handleLogin(event)
activate Controller

Controller -> Validator: isEmailValid(email)
activate Validator
Validator --> Controller: boolean
deactivate Validator

Controller -> Validator: isNotEmpty(password)
activate Validator
Validator --> Controller: boolean
deactivate Validator

alt Invalid Input
    Controller -> UI: Show error message\n"Invalid email or password format"
    UI -> Admin: Display error
else Valid Input Format
    Controller -> DAO: authenticate(email, password)
    activate DAO
    
    DAO -> DB: getInstance()
    activate DB
    DB --> DAO: connection
    deactivate DB
    
    DAO -> DB: SELECT * FROM users\nWHERE email = ? AND password = ?
    activate DB
    
    alt User Found
        DB --> DAO: User record
        deactivate DB
        DAO --> Controller: User object
        deactivate DAO
        
        Controller -> DAO: updateLastLogin(userID)
        activate DAO
        DAO -> DB: UPDATE users\nSET last_login = NOW()\nWHERE user_id = ?
        activate DB
        DB --> DAO: Success
        deactivate DB
        deactivate DAO
        
        Controller -> Dashboard: navigateTo("DashboardView.fxml")
        activate Dashboard
        Dashboard -> Admin: Display Dashboard
        deactivate Dashboard
        
    else User Not Found
        DB --> DAO: null
        deactivate DB
        DAO --> Controller: null
        deactivate DAO
        
        Controller -> UI: Show error message\n"Invalid credentials"
        UI -> Admin: Display error
    end
end

deactivate Controller


@enduml