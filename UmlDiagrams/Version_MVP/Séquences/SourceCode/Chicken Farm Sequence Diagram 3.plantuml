@startuml MVP_Sequence_Diagram_3_Chicken_Bay

title Sequence Diagram 3: View Chicken Bay

actor "Admin User" as Admin
participant "ChickenBayView" as UI
participant "ChickenBayController" as Controller
participant "HouseDAO" as HouseDAO
participant "ChickenDAO" as ChickenDAO
participant "MortalityDAO" as MortalityDAO
participant "DatabaseConnection" as DB
participant "DateUtil" as DateUtil

== Initialize Chicken Bay View ==

Admin -> UI: Navigate to Chicken Bay

UI -> Controller: initialize()
activate Controller

note right of Controller
    <b>Loads data for 4 houses:</b>
    • H1: Day-old chicks
    • H2: Egg Layers
    • H3: Meat Females
    • H4: Meat Males
end note

== Load House Cards ==

loop For each of 4 houses
    Controller -> HouseDAO: getHouseByNumber(houseNumber)
    activate HouseDAO
    HouseDAO -> DB: SELECT * FROM houses\nWHERE house_number = ?
    activate DB
    DB --> HouseDAO: House record
    deactivate DB
    HouseDAO --> Controller: House object
    deactivate HouseDAO
    
    Controller -> ChickenDAO: getChickensByHouse(houseID)
    activate ChickenDAO
    ChickenDAO -> DB: SELECT * FROM chickens\nWHERE house_id = ?
    activate DB
    DB --> ChickenDAO: List<Chicken>
    deactivate DB
    ChickenDAO --> Controller: chickens list
    deactivate ChickenDAO
    
    Controller -> ChickenDAO: getAverageAge(houseID)
    activate ChickenDAO
    ChickenDAO -> DB: SELECT AVG(age_in_days)\nFROM chickens\nWHERE house_id = ?
    activate DB
    DB --> ChickenDAO: average age
    deactivate DB
    ChickenDAO --> Controller: 45 days
    deactivate ChickenDAO
    
    Controller -> DateUtil: getDaysUntil(transferDate)
    activate DateUtil
    DateUtil --> Controller: 123 days
    deactivate DateUtil
    
    Controller -> UI: Create house card:\n• Health status\n• Average age: 45 days\n• Current count: 4,920\n• Days until transfer: 123
end

== Load Mortality Statistics ==

Controller -> MortalityDAO: getDeathsToday()
activate MortalityDAO
MortalityDAO -> DB: SELECT SUM(count)\nFROM mortality\nWHERE death_date = TODAY()
activate DB
DB --> MortalityDAO: 11 deaths
deactivate DB
MortalityDAO --> Controller: 11
deactivate MortalityDAO

Controller -> MortalityDAO: getDeathsThisWeek()
activate MortalityDAO
MortalityDAO -> DB: SELECT SUM(count)\nFROM mortality\nWHERE death_date >= (TODAY() - 7)
activate DB
DB --> MortalityDAO: 75 deaths
deactivate DB
MortalityDAO --> Controller: 75
deactivate MortalityDAO

Controller -> MortalityDAO: getDeathsThisMonth()
activate MortalityDAO
MortalityDAO -> DB: SELECT SUM(count)\nFROM mortality\nWHERE death_date >= (TODAY() - 30)
activate DB
DB --> MortalityDAO: 320 deaths
deactivate DB
MortalityDAO --> Controller: 320
deactivate MortalityDAO

Controller -> UI: Create mortality card:\n• Today: 11\n• This Week: 75\n• This Month: 320

deactivate Controller

UI -> Admin: Display 4 house cards + mortality card


@enduml