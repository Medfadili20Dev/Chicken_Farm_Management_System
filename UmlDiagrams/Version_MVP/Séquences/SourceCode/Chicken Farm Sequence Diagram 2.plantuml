@startuml MVP_Sequence_Diagram_2_View_Dashboard

title Sequence Diagram 2: View Dashboard

actor "Admin User" as Admin
participant "DashboardView" as UI
participant "DashboardController" as Controller
participant "ChickenDAO" as ChickenDAO
participant "EggProductionDAO" as EggDAO
participant "MortalityDAO" as MortalityDAO
participant "DatabaseConnection" as DB

== Dashboard Initialization ==

Admin -> UI: Navigate to Dashboard

UI -> Controller: initialize()
activate Controller

note right of Controller
    <b>Dashboard loads 4 key metrics:</b>
    1. Total chickens count
    2. Eggs produced today
    3. Active alerts count
    4. 7-day egg production chart
end note

par Load Total Chickens
    Controller -> ChickenDAO: getTotalCount()
    activate ChickenDAO
    ChickenDAO -> DB: SELECT COUNT(*)\nFROM chickens
    activate DB
    DB --> ChickenDAO: total count
    deactivate DB
    ChickenDAO --> Controller: 17,209 chickens
    deactivate ChickenDAO
    Controller -> UI: Update "Total Chickens" card\n(17,209)
end

par Load Today's Egg Production
    Controller -> EggDAO: getTodayProduction()
    activate EggDAO
    EggDAO -> DB: SELECT SUM(eggs_collected)\nFROM egg_production\nWHERE collection_date = TODAY()
    activate DB
    DB --> EggDAO: today's total
    deactivate DB
    EggDAO --> Controller: 4,200 eggs
    deactivate EggDAO
    Controller -> UI: Update "Eggs Today" card\n(4,200)
end

par Load Active Alerts
    Controller -> MortalityDAO: getDeathsToday()
    activate MortalityDAO
    MortalityDAO -> DB: SELECT COUNT(*)\nFROM mortality\nWHERE death_date = TODAY()
    activate DB
    DB --> MortalityDAO: deaths count
    deactivate DB
    MortalityDAO --> Controller: 11 deaths
    deactivate MortalityDAO
    
    Controller -> Controller: calculateAlerts()
    note right
        Alert Logic:
        • High mortality if rate > 5%
        • Low feed if < 7 days remaining
        • Equipment broken
    end note
    Controller -> UI: Update "Active Alerts" card\n(2 alerts)
end

== Load 7-Day Production Chart ==

Controller -> EggDAO: getLast7DaysProduction()
activate EggDAO
EggDAO -> DB: SELECT collection_date, SUM(eggs_collected)\nFROM egg_production\nWHERE collection_date >= (TODAY() - 7)\nGROUP BY collection_date
activate DB
DB --> EggDAO: List<EggProduction>
deactivate DB
EggDAO --> Controller: 7 days data
deactivate EggDAO

Controller -> Controller: prepareChartData()
Controller -> UI: Update BarChart with 7-day trend

deactivate Controller

UI -> Admin: Display complete dashboard



@enduml