@startuml SellToCustomer
actor Customer
actor Administration
actor Cashier
participant SalesUI
participant Database

Note over Customer,Database: TWO CUSTOMER TYPES

alt TYPE 1: Company Customer (butcher, hotel, restaurant)
    
    Note over Administration: One-time: Register company
    Administration->>SalesUI: Register company<br/>(name, ICE, RC, contact, products, payment terms)
    SalesUI->>Database: Save customer
    
    opt Regular customer
        Administration->>SalesUI: Create annual agreement<br/>(prices, payment terms, delivery schedule)
        SalesUI->>Database: Save agreement
    end

    Customer->>Administration: Send "Bon de Commande"
    
    Administration->>SalesUI: Create "Devis" (quotation)
    SalesUI->>Database: Save sale (QUOTE_SENT)
    Administration->>Customer: Send "Devis"
    
    Customer-->>Administration: Accept quotation
    
    Administration->>SalesUI: Prepare "Bon de Livraison"
    SalesUI->>Database: Update sale (READY_FOR_DELIVERY)
    
    Administration->>Customer: Deliver products
    Customer->>Customer: Sign "Bon de Livraison"
    Customer-->>Administration: Return signed copy
    
    Administration->>SalesUI: Record approved delivery
    SalesUI->>Database: Update sale (DELIVERED) + inventory (-quantity)
    
    Administration->>SalesUI: Generate "Facture"
    SalesUI->>Database: Save invoice
    Administration->>Customer: Send "Facture"
    
    Note over Customer: Payment terms: Net 30/60 days
    
    Customer->>Cashier: Pay (after 30/60 days)
    Cashier->>SalesUI: Record payment
    SalesUI->>Database: Save payment + income record

else TYPE 2: Individual Customer (walk-in)
    
    Customer->>Cashier: "I want X kg chicken/eggs"
    
    Cashier->>SalesUI: Enter customer info<br/>(name, phone - for tracking)
    SalesUI->>Database: Check if existing customer<br/>(for repeat customer recognition)
    
    Cashier->>SalesUI: Create sale (products, quantity)
    SalesUI->>SalesUI: Calculate price
    Cashier->>SalesUI: Print "Devis" (quotation)
    
    Cashier->>Customer: Show "Devis"
    Customer-->>Cashier: Accept
    
    Cashier->>Customer: Prepare products + "Bon de Livraison"
    
    Note over Customer: Immediate payment (no credit terms)
    
    Customer->>Cashier: Pay cash/card
    Cashier->>SalesUI: Record payment
    SalesUI->>Database: Save sale (PAID)<br/>Update inventory (-quantity)<br/>Save payment + income record
    
    Cashier->>SalesUI: Print receipt/ticket
    SalesUI-->>Customer: Receipt (legal proof)
    
    SalesUI->>Database: Save customer history<br/>(for loyalty tracking)
    
end
@enduml