@startuml OrderSalesManagement

' ========================================
' ORDER MANAGEMENT
' ========================================

class Order {
    +string orderID
    +string orderType
    +Date orderDate
    +string status
    +float totalAmount
    +Date deliveryDate
    +int paymentTerms
    +string supplierID
    +string customerID
    +string notes
    +createOrder()
    +confirmOrder()
    +cancelOrder()
    +calculateTotal()
}

class OrderLine {
    +string orderLineID
    +string orderID
    +string productID
    +int quantity
    +float unitPrice
    +float totalPrice
    +string notes
    +calculateLineTotal()
    +validateQuantity()
}

' ========================================
' SALES MANAGEMENT
' ========================================

class Sale {
    +string saleID
    +Date saleDate
    +string customerType
    +string customerID
    +float totalAmount
    +string paymentStatus
    +string receiptNumber
    +string handledBy
    +processSale()
    +calculateTotal()
    +generateReceipt()
    +updateInventory()
}

class SaleLine {
    +string saleLineID
    +string saleID
    +string productID
    +int quantity
    +float unitPrice
    +float totalPrice
    +string notes
    +calculateLineTotal()
    +checkAvailability()
}

' ========================================
' DELIVERY MANAGEMENT
' ========================================

class Delivery {
    +string deliveryID
    +Date deliveryDate
    +string status
    +string inspectionNotes
    +string approvedBy
    +string driverName
    +string vehicleNumber
    +Date inspectionDate
    +recordDelivery()
    +inspectGoods()
    +approveDelivery()
    +rejectDelivery()
}

' ========================================
' PAYMENT PROCESSING
' ========================================

class Payment {
    +string paymentID
    +string paymentType
    +float amount
    +string method
    +Date paymentDate
    +Date invoiceDate
    +string referenceNumber
    +string paidBy
    +string receivedBy
    +processPayment()
    +validateAmount()
    +generateReceipt()
    +recordTransaction()
}

' ========================================
' COMMERCIAL DOCUMENTS
' ========================================

class CommercialDocument {
    +string docID
    +string docType
    +string docNumber
    +Date issueDate
    +float amount
    +string status
    +string pdfPath
    +Date paymentDueDate
    +string sellerICE
    +string buyerICE
    +string notes
    +generateDocument()
    +validateICE()
    +sendDocument()
    +archiveDocument()
}

' ========================================
' SUPPLIER EVALUATION
' ========================================

class QuotationMatrix {
    +string matrixID
    +string supplierID
    +float costScore
    +float qualityScore
    +float delayScore
    +float totalScore
    +Date evaluationDate
    +string orderID
    +string evaluatedBy
    +calculateScores()
    +rankSuppliers()
    +selectBestSupplier()
}

' ========================================
' AGREEMENTS
' ========================================

class Agreement {
    +string agreementID
    +string agreementType
    +string supplierID
    +string customerID
    +string terms
    +Date startDate
    +Date endDate
    +int paymentDelay
    +string returnPolicy
    +float minimumOrder
    +Date renewalDate
    +createAgreement()
    +renewAgreement()
    +checkExpiry()
}

' ========================================
' BUSINESS ENTITIES (References)
' ========================================

class Supplier {
    +string supplierID
    +string companyName
    +string ice
    +string rc
    +string contactPerson
    +string phone
    +string email
}

class Customer {
    +string customerID
    +string name
    +string phone
    +string email
    +string customerType
}

class Product {
    +string productID
    +string productName
    +string productType
    +float price
    +string unit
}

class Company {
    +string companyID
    +string companyName
    +string ice
    +string rc
}

' ========================================
' ORDER RELATIONSHIPS
' ========================================

Supplier "1" -- "*" Order : supplies >
Customer "1" -- "*" Order : places >
Order "1" *-- "1..*" OrderLine : contains
Product "1" -- "*" OrderLine : ordered_in >
Order "1" -- "0..1" Delivery : results_in >
Order "1" *-- "1..*" CommercialDocument : generates

' ========================================
' SALES RELATIONSHIPS
' ========================================

Customer "1" -- "*" Sale : makes >
Sale "1" *-- "1..*" SaleLine : contains
Product "1" -- "*" SaleLine : sold_in >
Sale "1" *-- "1..*" CommercialDocument : documented_by

' ========================================
' DELIVERY RELATIONSHIPS
' ========================================

Delivery "1" -- "1..*" CommercialDocument : documented_by >

' ========================================
' PAYMENT RELATIONSHIPS
' ========================================

Supplier "1" -- "*" Payment : receives >
Customer "1" -- "*" Payment : makes >
CommercialDocument "1" -- "0..1" Payment : triggers >
Order "1" -- "*" Payment : paid_by >
Sale "1" -- "*" Payment : paid_by >

' ========================================
' AGREEMENT RELATIONSHIPS
' ========================================

Supplier "1" -- "0..1" Agreement : signs >
Customer "1" -- "0..1" Agreement : signs >
Company "1" -- "*" Agreement : manages >

' ========================================
' SUPPLIER EVALUATION
' ========================================

Supplier "1" -- "*" QuotationMatrix : evaluated_by >
Order "1" -- "0..1" QuotationMatrix : uses >

' ========================================
' ASSOCIATION CLASS RELATIONSHIPS
' ========================================

Order .. OrderLine : association
Product .. OrderLine : association
Sale .. SaleLine : association
Product .. SaleLine : association

' ========================================
' CONSTRAINTS & WORKFLOW NOTES
' ========================================

note right of Order
    Order Types:
    - SUPPLIER_ORDER (purchasing)
    - CUSTOMER_ORDER (selling)
    
    Status Flow:
    DRAFT → SENT → CONFIRMED
      → DELIVERED → (terminal)
    DRAFT → CANCELLED (terminal)
    
    Constraints:
    {deliveryDate ≥ orderDate}
    {totalAmount = Σ(OrderLine.totalPrice)}
end note

note right of CommercialDocument
    Document Types:
    1. INITIAL_ORDER (bon commande initial)
    2. QUOTATION (devis)
    3. FINAL_ORDER (bon commande final)
    4. DELIVERY_NOTE (bon livraison)
    5. INVOICE (facture)
    6. CREDIT_NOTE (avoir)
    7. RECEIPT (reçu)
    
    Moroccan Law:
    {sellerICE.length = 15} (mandatory)
    {buyerICE.length = 15} (mandatory)
    {invoice.amount = delivery.amount}
end note

note right of Payment
    Payment Types:
    - TO_SUPPLIER (purchases)
    - FROM_CUSTOMER (sales)
    - TO_WORKER (salaries)
    
    Methods:
    - CASH
    - BANK_TRANSFER
    - CHECK
    - CREDIT_CARD
    
    Constraints:
    {paymentDate ≥ invoiceDate}
    {amount > 0}
    {Σ payments = order.totalAmount}
end note

note right of Delivery
    Delivery Status:
    - PENDING
    - INSPECTED
    - APPROVED
    - REJECTED
    - DAMAGED
    
    Inspection Process:
    1. Receive goods
    2. Check quantity
    3. Check quality
    4. Approve/Reject
    5. Generate avoir if damaged
end note

note right of QuotationMatrix
    Supplier Evaluation:
    costScore (40%)
    qualityScore (35%)
    delayScore (25%)
    = totalScore (0-10)
    
    Best supplier = MAX(totalScore)
    
    Used when comparing
    multiple supplier quotations
end note

note right of Agreement
    Agreement Types:
    - SUPPLIER (annual contracts)
    - CUSTOMER (annual contracts)
    
    Terms:
    - Payment delay (0/30/60/90 days)
    - Return policy
    - Minimum order quantity
    - Price terms
    
    Renewal:
    {renewalDate = endDate - 30 days}
end note

note right of Sale
    Customer Types:
    
    INDIVIDUAL:
    - Cash payment only
    - Immediate transaction
    - Receipt issued
    
    COMPANY:
    - Credit terms (Net 30/60)
    - Invoicing
    - Agreement required
    
    {totalAmount = Σ(SaleLine.totalPrice)}
end note

@enduml